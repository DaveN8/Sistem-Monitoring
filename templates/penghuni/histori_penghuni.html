{% extends 'base.html' %}

{% block title %}Histori{% endblock %}

{% block navbar %}
{% include 'navbar_penghuni.html' %}
{% endblock %}

{% block content %}
<div class="p-4 sm:p-6">
    <h2 class="text-xl font-bold mb-4">Histori Penggunaan Listrik</h2>

    <form method="get" class="mb-4 flex flex-col sm:flex-row sm:items-center gap-2">
        <label for="bulan" class="text-sm">Filter Bulan:</label>
        <input type="month" name="bulan" id="bulan" value="{{ bulan_filter }}"
            class="border px-2 py-1 rounded w-full sm:w-auto">
        <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Terapkan</button>
    </form>

    <div class="my-4 py-4 bg-gray-100 rounded text-sm">
        <p><strong>Batas Pemakaian Bulanan:</strong> {{ batas_kwh }} kWh</p>
        <p><strong>Total Penggunaan Bulan Ini:</strong> {{ total_kwh }} kWh</p>
    </div>

    {% if histori %}
    <div class="bg-white shadow rounded divide-y text-sm">
        {% for h in histori %}
        <div class="p-4">
            <p><strong>Tanggal:</strong> {{ h.Timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p><strong>Penggunaan:</strong> {{ h.kWh }} kWh</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-sm">Tidak ada data histori untuk bulan ini.</p>
    {% endif %}

    <!-- Pagination -->
    <div class="mt-4 flex flex-col sm:flex-row justify-between items-center text-sm gap-2">
        {% if page > 1 %}
        <a href="?page={{ page-1 }}{% if bulan_filter %}&bulan={{ bulan_filter }}{% endif %}"
            class="text-blue-600 hover:underline">← Sebelumnya</a>
        {% endif %}
        <span>Halaman {{ page }} dari {{ total_pages }}</span>
        {% if page < total_pages %} <a
            href="?page={{ page+1 }}{% if bulan_filter %}&bulan={{ bulan_filter }}{% endif %}"
            class="text-blue-600 hover:underline">Selanjutnya →</a>
            {% endif %}
    </div>
</div>
{% endblock %}